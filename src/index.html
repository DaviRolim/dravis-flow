<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DraVis Flow</title>
    <link rel="stylesheet" href="style.css" />
    <script type="module" src="./main.js" defer></script>
  </head>
  <body class="theme-cyberpunk">
    <main id="setup" class="setup hidden">
      <header class="window-head">
        <div class="window-title">
          <p class="eyebrow">Voice Console</p>
          <h1>DraVis Flow</h1>
          <p class="lead">Control your local Whisper recording pipeline.</p>
        </div>
      </header>

      <section class="panel">
        <h2>Whisper Model</h2>
        <p class="panel-copy">Larger models are more accurate but use more memory.</p>
        <div id="model-switch" class="mode-switch" role="radiogroup" aria-label="Whisper model">
          <button class="mode-btn" type="button" data-model="base.en" role="radio">
            <span class="mode-title">Base — 142 MB</span>
            <span class="mode-copy">Fast, good for simple dictation.</span>
          </button>
          <button class="mode-btn" type="button" data-model="small.en" role="radio">
            <span class="mode-title">Small — 466 MB</span>
            <span class="mode-copy">Better accuracy, handles accents.</span>
          </button>
          <button class="mode-btn" type="button" data-model="large-v3-turbo" role="radio">
            <span class="mode-title">Large Turbo — 809 MB</span>
            <span class="mode-copy">Best quality. Cleans stutters and fillers.</span>
          </button>
        </div>
        <p id="model-status" class="mode-status" aria-live="polite">Loading selected model...</p>
      </section>

      <section class="panel">
        <h2>Model Status</h2>
        <p id="setup-message" aria-live="polite">Checking local model...</p>
        <button id="download-btn" class="primary hidden">Download Model</button>
        <div id="progress-wrap" class="progress-wrap hidden" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="progress-track">
            <div id="progress" class="progress-bar"></div>
          </div>
          <span id="progress-text">0%</span>
        </div>
      </section>

      <section class="panel">
        <h2>Prompt Mode</h2>
        <p class="panel-copy">Restructure transcription into a clean LLM-ready prompt before paste.</p>
        <label class="switch-row" for="prompt-mode-enabled">
          <span class="switch-copy">Enable Prompt Mode</span>
          <span class="switch-control">
            <input id="prompt-mode-enabled" class="switch-input" type="checkbox" />
            <span class="switch-slider" aria-hidden="true"></span>
          </span>
        </label>
        <div id="prompt-provider-switch" class="provider-switch" role="group" aria-label="Prompt provider">
          <button class="provider-btn" id="prompt-provider-anthropic" data-provider="anthropic" type="button">
            Anthropic
          </button>
          <button class="provider-btn" id="prompt-provider-openai" data-provider="openai" type="button">
            OpenAI
          </button>
          <button class="provider-btn" id="prompt-provider-openrouter" data-provider="openrouter" type="button">
            OpenRouter
          </button>
        </div>
        <label for="prompt-api-key" class="sr-only">Prompt provider API key</label>
        <div class="secret-input-row">
          <input
            id="prompt-api-key"
            class="tag-input"
            type="password"
            placeholder="API key"
            autocomplete="off"
            spellcheck="false"
          />
          <button id="prompt-api-visibility-btn" class="secondary" type="button">Show</button>
        </div>
      </section>

      <section class="panel">
        <h2>Vocabulary</h2>
        <p class="panel-copy">Words Whisper should recognize. Tech terms, names, jargon.</p>
        <div id="vocab-list" class="tag-list"></div>
        <div class="tag-input-row">
          <label for="vocab-input" class="sr-only">Add vocabulary word</label>
          <input id="vocab-input" class="tag-input" type="text" placeholder="Add word…" autocomplete="off" />
          <button id="vocab-add-btn" class="primary" type="button">Add</button>
        </div>
      </section>

      <section class="panel">
        <h2>Replacements</h2>
        <p class="panel-copy">Auto-replace words after transcription.</p>
        <div id="replacements-list" class="replacement-list"></div>
        <div class="replacement-input-row">
          <label for="replacement-from-input" class="sr-only">Replace this word</label>
          <input id="replacement-from-input" class="tag-input" type="text" placeholder="From…" autocomplete="off" />
          <span class="replacement-input-sep">→</span>
          <label for="replacement-to-input" class="sr-only">Replace with this word</label>
          <input id="replacement-to-input" class="tag-input" type="text" placeholder="To…" autocomplete="off" />
          <button id="replacement-add-btn" class="primary" type="button">Add</button>
        </div>
      </section>

      <p id="dict-error-msg" role="alert" aria-live="assertive" class="error-toast hidden"></p>

      <p id="hotkey-hint" class="hint">Hold <code>Ctrl+Shift+Space</code> to talk · Tap once to toggle on/off</p>
    </main>

    <main id="widget" class="widget-root hidden" aria-live="polite">
      <div class="recording-pill hold-mode" id="recording-pill">
        <button id="cancel-btn" class="widget-btn widget-btn-ghost" type="button" aria-label="Cancel recording">
          <span aria-hidden="true">&times;</span>
        </button>

        <div class="waveform-wrap">
          <div class="waveform" id="waveform" aria-hidden="true"></div>
        </div>

        <button id="prompt-mode-btn" class="widget-btn widget-btn-mode" type="button" aria-label="Enable Prompt Mode">
          <span id="prompt-mode-icon" aria-hidden="true">&#9998;</span>
        </button>

        <button id="stop-btn" class="widget-btn widget-btn-stop" type="button" aria-label="Stop recording">
          <span class="stop-square" aria-hidden="true"></span>
        </button>
      </div>
    </main>
  </body>
</html>
